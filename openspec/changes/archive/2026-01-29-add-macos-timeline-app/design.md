## Context
构建一个 macOS 原生的工作记录时间轴应用。

### 核心设计哲学
> **用户只管记，App 帮你理**

目标用户是平时不习惯收集信息的人，所以：
- **输入必须极简**：不要让用户思考"该选什么分类"，一个输入框搞定
- **整理交给 AI**：自动提取关键信息、自动打标签、自动归类
- **汇报一键生成**：选时间范围，AI 输出结构化汇报

### 约束条件
- macOS 14.0+ (Sonoma) - 使用最新的 SwiftData 和 SwiftUI 特性
- 纯本地存储，无云服务依赖
- 需要 Accessibility 权限用于全局快捷键

### 利益相关者
- 主要用户：需要定期汇报工作但平时不习惯记录的职场人士

## Goals / Non-Goals

### Goals
- **极简记录**：5 秒内完成一条记录，无需任何分类操作
- **零整理负担**：AI 自动提取、分类、打标签
- **高效汇报**：选择时间范围，1 分钟生成汇报初稿
- **原生体验**：遵循 macOS 设计规范，流畅自然

### Non-Goals
- 手动分类管理（违背"用户不整理"的原则）
- 多设备同步（后续版本考虑）
- 团队协作功能
- 复杂的项目管理功能
- Windows/Linux 支持

## Decisions

### 1. 技术栈选择：Swift + SwiftUI + SwiftData
**决定**：使用 Apple 原生技术栈
**理由**：
- SwiftUI 提供声明式 UI，开发效率高
- SwiftData 是 Apple 最新的数据持久化框架，与 SwiftUI 深度集成
- 原生应用性能最优，系统集成最好（菜单栏、快捷键）
- 无需额外运行时，应用体积小

**替代方案**：
- Electron：跨平台但体积大、性能差
- Tauri：较新，macOS 系统集成不如原生

### 2. 应用形态：完整桌面应用 + 快捷入口
**决定**：主界面为标准 macOS 桌面窗口应用，同时提供快捷入口
**理由**：
- 完整的桌面窗口，有足够空间展示时间轴、筛选、汇报等功能
- 在 Dock 中显示，符合用户对"应用"的认知
- 同时提供菜单栏图标作为快捷入口（可选）
- 全局快捷键唤起悬浮输入窗，实现快速记录

**应用结构**：
```
主窗口（桌面应用）
├── 侧边栏：时间筛选、标签筛选、AI 汇报入口
├── 主区域：时间轴记录列表
├── 顶部：搜索栏 + 新建按钮
└── 底部：快速输入区域

悬浮输入窗（快捷键唤起）
└── 极简输入框，记完即关

菜单栏图标（可选）
└── 快捷访问、状态显示
```

### 3. 输入交互设计
**决定**：输入窗口只有一个文本框，没有分类选择、没有标签选择
**理由**：
- 符合"用户只管记"的哲学
- 任何额外的选项都会增加心智负担
- 分类和标签由 AI 在后台自动处理
- 用户可以用 #标签 语法手动指定（可选，非必须）

### 4. 数据模型设计
**决定**：简化模型，核心为 Entry + Tag，标签由 AI 自动生成
```
Entry {
  id: UUID
  content: String        // 原始记录内容（Markdown）
  tags: [Tag]           // AI 自动生成的标签
  createdAt: Date       // 创建时间
  extractedData: JSON?  // AI 提取的结构化数据
}

Tag {
  id: UUID
  name: String
  color: String         // 自动分配颜色
  isAutoGenerated: Bool // 是否 AI 生成
  entries: [Entry]
}
```
**理由**：
- 用户输入只需要 content
- 其他字段全部由 AI 自动填充
- 标签自动生成，用户无需手动管理

### 5. AI 自动处理流程
**决定**：记录保存后，AI 在后台异步处理
```
用户输入 → 立即保存 → 后台 AI 处理 → 更新记录
                ↓
          (用户已完成操作)
```
**理由**：
- 不阻塞用户操作，保证"记完即走"
- AI 处理失败不影响记录保存
- 处理完成后静默更新，用户无感知

### 6. AI 集成方案
**决定**：支持多种 AI 后端
- OpenAI API（云端）
- 本地 Ollama（隐私优先）
**理由**：
- 给用户选择权，平衡便捷性和隐私
- 本地模型不依赖网络，数据不出设备

### 6. AI 集成方案
**决定**：支持多种 AI 后端
- OpenAI API（云端）
- 本地 Ollama（隐私优先）
**理由**：
- 给用户选择权，平衡便捷性和隐私
- 本地模型不依赖网络，数据不出设备

### 7. 快捷键实现
**决定**：使用 HotKey 库或原生 CGEvent 实现全局快捷键
**理由**：
- 需要在任何应用中都能唤起
- 需要申请 Accessibility 权限

## Risks / Trade-offs

### 风险1：Accessibility 权限申请
- **风险**：用户可能不愿意授予权限
- **缓解**：提供清晰的权限说明；菜单栏点击作为备选方案

### 风险2：AI 功能依赖外部服务
- **风险**：OpenAI API 可能不可用或产生费用
- **缓解**：支持本地 Ollama；AI 功能为增强而非核心依赖

### 风险3：SwiftData 稳定性
- **风险**：SwiftData 相对较新，可能有 bug
- **缓解**：做好数据备份机制；必要时可回退到 Core Data

## Migration Plan
不适用（全新项目）

## Resolved Questions

### 1. 默认快捷键
**决定**：`⌘ + Shift + N`（New entry）

### 2. AI 提取的结构化数据字段
**决定**：提取以下字段
```swift
struct ExtractedData: Codable {
    var metrics: [Metric]?       // 关键指标，如 "DAU提升20%"
    var dates: [ImportantDate]?  // 关键日期，如 "3月15日上线"
    var projects: [String]?      // 识别的项目名称
    var keywords: [String]?      // 关键词/技术栈
}

struct Metric: Codable {
    var name: String      // 指标名称，如 "DAU"
    var value: String     // 数值，如 "20%"
    var trend: String?    // 趋势，如 "提升"、"下降"
}

struct ImportantDate: Codable {
    var date: Date        // 日期
    var event: String     // 事件描述
}
```

### 3. Markdown 支持
**决定**：支持 Markdown 格式输入
- 输入时支持 Markdown 语法
- 展示时渲染 Markdown（标题、列表、粗体、代码块等）
- 导出时保留 Markdown 格式
